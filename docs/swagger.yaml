basePath: /v1
definitions:
  github_com_blaisecz_sleep-tracker_internal_domain.ChronotypeResult:
    description: Chronotype analysis result.
    properties:
      chronotype:
        allOf:
        - $ref: '#/definitions/github_com_blaisecz_sleep-tracker_internal_domain.ChronotypeType'
        description: Chronotype classification
        example: intermediate
      mid_sleep_local_time:
        description: Mid-sleep time in local timezone (HH:MM format)
        example: "03:45"
        type: string
      mid_sleep_minutes_after_midnight:
        description: Minutes after midnight for mid-sleep
        example: 225
        type: integer
      sleeps_used:
        description: Number of sleep logs used in calculation
        example: 28
        type: integer
      window_days:
        description: Number of days in the analysis window
        example: 30
        type: integer
    type: object
  github_com_blaisecz_sleep-tracker_internal_domain.ChronotypeType:
    description: Chronotype classification based on mid-sleep time.
    enum:
    - early_bird
    - intermediate
    - night_owl
    - unknown
    type: string
    x-enum-varnames:
    - ChronotypeEarlyBird
    - ChronotypeIntermediate
    - ChronotypeNightOwl
    - ChronotypeUnknown
  github_com_blaisecz_sleep-tracker_internal_domain.CreateSleepLogRequest:
    description: Request payload for recording a sleep session.
    properties:
      client_request_id:
        description: Optional client-generated ID for idempotent requests (max 255
          chars)
        example: client-uuid-12345
        maxLength: 255
        type: string
      end_at:
        description: Sleep end time in RFC3339 format (must be after start_at)
        example: "2024-01-16T07:00:00Z"
        type: string
      local_timezone:
        description: Optional IANA timezone for local time display (defaults to user's
          timezone)
        example: Europe/Prague
        type: string
      quality:
        description: Sleep quality rating from 1 (poor) to 10 (excellent)
        example: 7
        maximum: 10
        minimum: 1
        type: integer
      start_at:
        description: Sleep start time in RFC3339 format (UTC recommended)
        example: "2024-01-15T23:00:00Z"
        type: string
      type:
        allOf:
        - $ref: '#/definitions/github_com_blaisecz_sleep-tracker_internal_domain.SleepType'
        description: 'Sleep type: CORE (main sleep) or NAP (daytime nap)'
        enum:
        - CORE
        - NAP
        example: CORE
    required:
    - end_at
    - quality
    - start_at
    - type
    type: object
  github_com_blaisecz_sleep-tracker_internal_domain.CreateUserRequest:
    description: Request payload for creating a new user account.
    properties:
      timezone:
        description: |-
          IANA timezone identifier (e.g., "America/New_York", "Europe/London", "UTC").
          See: https://en.wikipedia.org/wiki/List_of_tz_database_time_zones
        example: Europe/Prague
        type: string
    required:
    - timezone
    type: object
  github_com_blaisecz_sleep-tracker_internal_domain.DailyOverallMetrics:
    description: Daily total sleep metrics (core + naps combined).
    properties:
      daily_sufficiency_score:
        description: Percentage of days meeting target (0-100)
        example: 73.3
        type: number
      days_count:
        description: Number of days with sleep data
        example: 30
        type: integer
      days_meeting_target:
        description: Number of days meeting the target
        example: 22
        type: integer
      target_hours:
        description: Target hours for sufficiency calculation
        example: 7
        type: number
      total_daily_hours:
        allOf:
        - $ref: '#/definitions/github_com_blaisecz_sleep-tracker_internal_domain.DescriptiveStats'
        description: Total daily sleep hours statistics
    type: object
  github_com_blaisecz_sleep-tracker_internal_domain.DerivedScores:
    description: Derived scores based on sleep metrics.
    properties:
      consistency_score:
        description: Consistency score based on bedtime variability (0-100)
        example: 75
        type: number
      overall_sleep_score:
        description: Overall sleep score combining factors (0-100)
        example: 77.5
        type: number
      sufficiency_score:
        description: Sufficiency score based on duration meeting targets (0-100)
        example: 80
        type: number
    type: object
  github_com_blaisecz_sleep-tracker_internal_domain.DescriptiveStats:
    description: Basic statistical measures for a metric.
    properties:
      avg:
        example: 7.2
        type: number
      max:
        example: 9
        type: number
      min:
        example: 5.5
        type: number
      std:
        example: 0.8
        type: number
    type: object
  github_com_blaisecz_sleep-tracker_internal_domain.InsightsResponse:
    description: Complete sleep insights response.
    properties:
      chronotype:
        allOf:
        - $ref: '#/definitions/github_com_blaisecz_sleep-tracker_internal_domain.ChronotypeResult'
        description: Chronotype analysis
      insights:
        allOf:
        - $ref: '#/definitions/github_com_blaisecz_sleep-tracker_internal_domain.LLMInsightsOutput'
        description: LLM-generated insights
      metrics:
        description: Metrics for different time windows
        properties:
          history:
            $ref: '#/definitions/github_com_blaisecz_sleep-tracker_internal_domain.WindowMetrics'
          last_night:
            $ref: '#/definitions/github_com_blaisecz_sleep-tracker_internal_domain.WindowMetrics'
          recent:
            $ref: '#/definitions/github_com_blaisecz_sleep-tracker_internal_domain.WindowMetrics'
        type: object
      trace_id:
        description: Trace ID for feedback (optional, only present when Langfuse is
          enabled)
        example: 550e8400-e29b-41d4-a716-446655440000
        type: string
    type: object
  github_com_blaisecz_sleep-tracker_internal_domain.LLMInsightsOutput:
    description: LLM-generated sleep insights.
    properties:
      guidance:
        description: Actionable guidance (3-5 items)
        example:
        - '["Try to maintain your current bedtime of around 11 PM"]'
        items:
          type: string
        type: array
      observations:
        description: Observations about patterns (3-6 items)
        example:
        - '["Average duration of 7.2 hours meets recommended guidelines"]'
        items:
          type: string
        type: array
      summary:
        description: Summary of sleep patterns (2-3 sentences)
        example: Your sleep has been fairly consistent this week...
        type: string
    type: object
  github_com_blaisecz_sleep-tracker_internal_domain.MetricsResponse:
    description: Sleep metrics response with window statistics.
    properties:
      daily_overall:
        allOf:
        - $ref: '#/definitions/github_com_blaisecz_sleep-tracker_internal_domain.DailyOverallMetrics'
        description: Daily overall metrics
      per_sleep:
        allOf:
        - $ref: '#/definitions/github_com_blaisecz_sleep-tracker_internal_domain.PerSleepMetrics'
        description: Per-sleep metrics
      scores:
        allOf:
        - $ref: '#/definitions/github_com_blaisecz_sleep-tracker_internal_domain.DerivedScores'
        description: Derived scores
      window:
        description: Analysis window
        properties:
          from:
            example: "2024-01-01T00:00:00Z"
            type: string
          to:
            example: "2024-01-31T23:59:59Z"
            type: string
        type: object
    type: object
  github_com_blaisecz_sleep-tracker_internal_domain.PaginationResponse:
    description: Cursor-based pagination info.
    properties:
      has_more:
        description: True if more results are available
        example: true
        type: boolean
      next_cursor:
        description: Cursor for fetching the next page (empty if no more pages)
        example: eyJpZCI6IjU1MGU4NDAwLWUyOWItNDFkNC1hNzE2LTQ0NjY1NTQ0MDAwMCJ9
        type: string
    type: object
  github_com_blaisecz_sleep-tracker_internal_domain.PerSleepMetrics:
    description: Per-sleep metrics aggregated over a time window.
    properties:
      bedtime:
        allOf:
        - $ref: '#/definitions/github_com_blaisecz_sleep-tracker_internal_domain.DescriptiveStats'
        description: Bedtime statistics in minutes after midnight
      duration:
        allOf:
        - $ref: '#/definitions/github_com_blaisecz_sleep-tracker_internal_domain.DescriptiveStats'
        description: Duration statistics in hours
      quality:
        allOf:
        - $ref: '#/definitions/github_com_blaisecz_sleep-tracker_internal_domain.DescriptiveStats'
        description: Quality statistics (1-10 scale)
      sleep_count:
        description: Number of sleep logs in this window
        example: 28
        type: integer
    type: object
  github_com_blaisecz_sleep-tracker_internal_domain.SleepLogListResponse:
    description: Paginated list of sleep logs.
    properties:
      data:
        description: Array of sleep log records
        items:
          $ref: '#/definitions/github_com_blaisecz_sleep-tracker_internal_domain.SleepLogResponse'
        type: array
      pagination:
        allOf:
        - $ref: '#/definitions/github_com_blaisecz_sleep-tracker_internal_domain.PaginationResponse'
        description: Pagination metadata
    type: object
  github_com_blaisecz_sleep-tracker_internal_domain.SleepLogResponse:
    description: Sleep session record with UTC and local times.
    properties:
      client_request_id:
        description: Client-provided request ID (if any)
        example: client-uuid-12345
        type: string
      created_at:
        description: Record creation timestamp
        example: "2024-01-16T07:05:00Z"
        type: string
      end_at:
        description: Sleep end time (UTC)
        example: "2024-01-16T07:00:00Z"
        type: string
      id:
        description: Unique sleep log identifier
        example: 550e8400-e29b-41d4-a716-446655440000
        type: string
      local_end_at:
        description: Sleep end in local timezone
        example: "2024-01-16T08:00:00+01:00"
        type: string
      local_start_at:
        description: Sleep start in local timezone
        example: "2024-01-16T00:00:00+01:00"
        type: string
      local_timezone:
        description: Timezone used for local times
        example: Europe/Prague
        type: string
      quality:
        description: Sleep quality (1-10)
        example: 7
        type: integer
      start_at:
        description: Sleep start time (UTC)
        example: "2024-01-15T23:00:00Z"
        type: string
      type:
        allOf:
        - $ref: '#/definitions/github_com_blaisecz_sleep-tracker_internal_domain.SleepType'
        description: Sleep type
        example: CORE
      user_id:
        description: Owner user ID
        example: 660e8400-e29b-41d4-a716-446655440001
        type: string
    type: object
  github_com_blaisecz_sleep-tracker_internal_domain.SleepType:
    description: 'Type of sleep: CORE for main night sleep, NAP for daytime naps.'
    enum:
    - CORE
    - NAP
    type: string
    x-enum-varnames:
    - SleepTypeCore
    - SleepTypeNap
  github_com_blaisecz_sleep-tracker_internal_domain.UpdateSleepLogRequest:
    description: Request payload for updating a sleep session. All fields are optional.
    properties:
      end_at:
        description: Sleep end time in RFC3339 format (must be after start_at if both
          provided)
        example: "2024-01-16T07:00:00Z"
        type: string
      local_timezone:
        description: Optional IANA timezone for local time display
        example: Europe/Prague
        type: string
      quality:
        description: Sleep quality rating from 1 (poor) to 10 (excellent)
        example: 7
        maximum: 10
        minimum: 1
        type: integer
      start_at:
        description: Sleep start time in RFC3339 format (UTC recommended)
        example: "2024-01-15T23:00:00Z"
        type: string
      type:
        allOf:
        - $ref: '#/definitions/github_com_blaisecz_sleep-tracker_internal_domain.SleepType'
        description: 'Sleep type: CORE (main sleep) or NAP (daytime nap)'
        enum:
        - CORE
        - NAP
        example: CORE
    type: object
  github_com_blaisecz_sleep-tracker_internal_domain.UserResponse:
    description: User account details.
    properties:
      created_at:
        description: Account creation timestamp (RFC3339)
        example: "2024-01-15T10:30:00Z"
        type: string
      id:
        description: Unique user identifier
        example: 550e8400-e29b-41d4-a716-446655440000
        type: string
      timezone:
        description: User's preferred IANA timezone
        example: Europe/Prague
        type: string
    type: object
  github_com_blaisecz_sleep-tracker_internal_domain.WindowMetrics:
    description: Complete metrics for a time window.
    properties:
      daily_overall:
        allOf:
        - $ref: '#/definitions/github_com_blaisecz_sleep-tracker_internal_domain.DailyOverallMetrics'
        description: Daily overall metrics (core + naps)
      from:
        description: Window start date
        example: "2024-01-01T00:00:00Z"
        type: string
      per_sleep:
        allOf:
        - $ref: '#/definitions/github_com_blaisecz_sleep-tracker_internal_domain.PerSleepMetrics'
        description: Per-sleep metrics
      scores:
        allOf:
        - $ref: '#/definitions/github_com_blaisecz_sleep-tracker_internal_domain.DerivedScores'
        description: Derived scores
      to:
        description: Window end date
        example: "2024-01-31T23:59:59Z"
        type: string
    type: object
  github_com_blaisecz_sleep-tracker_pkg_problem.FieldError:
    properties:
      field:
        type: string
      message:
        type: string
    type: object
  github_com_blaisecz_sleep-tracker_pkg_problem.Problem:
    properties:
      detail:
        type: string
      errors:
        items:
          $ref: '#/definitions/github_com_blaisecz_sleep-tracker_pkg_problem.FieldError'
        type: array
      status:
        type: integer
      title:
        type: string
      type:
        type: string
    type: object
  internal_api_handler.FeedbackRequest:
    description: Request body for submitting feedback on insights.
    properties:
      comment:
        description: Optional comment
        example: The insights were helpful!
        type: string
      score:
        description: Rating score (1-5)
        example: 4
        maximum: 5
        minimum: 1
        type: integer
      trace_id:
        description: Trace ID from the insights response
        example: 550e8400-e29b-41d4-a716-446655440000
        type: string
    type: object
info:
  contact: {}
  description: Track sleep sessions with start/end times, quality ratings, and timezone
    support.
  title: Sleep Tracker API
  version: "1.0"
paths:
  /users:
    post:
      consumes:
      - application/json
      description: Register a new user with their preferred timezone. The timezone
        is used for displaying sleep times in local format.
      parameters:
      - description: User data
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/github_com_blaisecz_sleep-tracker_internal_domain.CreateUserRequest'
      produces:
      - application/json
      responses:
        "201":
          description: User created successfully
          schema:
            $ref: '#/definitions/github_com_blaisecz_sleep-tracker_internal_domain.UserResponse'
        "400":
          description: Invalid request (malformed JSON or invalid timezone)
          schema:
            $ref: '#/definitions/github_com_blaisecz_sleep-tracker_pkg_problem.Problem'
        "500":
          description: Server error
          schema:
            $ref: '#/definitions/github_com_blaisecz_sleep-tracker_pkg_problem.Problem'
      summary: Create user
      tags:
      - users
  /users/{userId}:
    get:
      description: Retrieve user details including timezone preference.
      parameters:
      - description: User UUID
        example: 550e8400-e29b-41d4-a716-446655440000
        format: uuid
        in: path
        name: userId
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: User details
          schema:
            $ref: '#/definitions/github_com_blaisecz_sleep-tracker_internal_domain.UserResponse'
        "400":
          description: Invalid UUID format
          schema:
            $ref: '#/definitions/github_com_blaisecz_sleep-tracker_pkg_problem.Problem'
        "404":
          description: User not found
          schema:
            $ref: '#/definitions/github_com_blaisecz_sleep-tracker_pkg_problem.Problem'
        "500":
          description: Server error
          schema:
            $ref: '#/definitions/github_com_blaisecz_sleep-tracker_pkg_problem.Problem'
      summary: Get user
      tags:
      - users
  /users/{userId}/sleep-logs:
    get:
      description: Fetch paginated sleep history. Filter by date range. Results sorted
        by start_at descending (newest first).
      parameters:
      - description: User UUID
        example: 550e8400-e29b-41d4-a716-446655440000
        format: uuid
        in: path
        name: userId
        required: true
        type: string
      - description: Start of date range (RFC3339, UTC recommended for consistent
          filtering)
        example: "2024-01-01T00:00:00Z"
        format: date-time
        in: query
        name: from
        type: string
      - description: End of date range (RFC3339, UTC recommended for consistent filtering)
        example: "2024-01-31T23:59:59Z"
        format: date-time
        in: query
        name: to
        type: string
      - default: 20
        description: Results per page (1-100)
        in: query
        maximum: 100
        minimum: 1
        name: limit
        type: integer
      - description: Cursor from previous response's next_cursor
        in: query
        name: cursor
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: Sleep logs with pagination
          schema:
            $ref: '#/definitions/github_com_blaisecz_sleep-tracker_internal_domain.SleepLogListResponse'
        "400":
          description: Invalid query parameters
          schema:
            $ref: '#/definitions/github_com_blaisecz_sleep-tracker_pkg_problem.Problem'
        "404":
          description: User not found
          schema:
            $ref: '#/definitions/github_com_blaisecz_sleep-tracker_pkg_problem.Problem'
        "500":
          description: Server error
          schema:
            $ref: '#/definitions/github_com_blaisecz_sleep-tracker_pkg_problem.Problem'
      summary: List sleep logs
      tags:
      - sleep-logs
    post:
      consumes:
      - application/json
      description: Log a sleep session. Use client_request_id for safe retries (idempotency).
        Returns 200 if duplicate request, 201 if new.
      parameters:
      - description: User UUID
        example: 550e8400-e29b-41d4-a716-446655440000
        format: uuid
        in: path
        name: userId
        required: true
        type: string
      - description: Sleep session data
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/github_com_blaisecz_sleep-tracker_internal_domain.CreateSleepLogRequest'
      produces:
      - application/json
      responses:
        "200":
          description: Existing log returned (idempotent duplicate)
          schema:
            $ref: '#/definitions/github_com_blaisecz_sleep-tracker_internal_domain.SleepLogResponse'
        "201":
          description: New sleep log created
          schema:
            $ref: '#/definitions/github_com_blaisecz_sleep-tracker_internal_domain.SleepLogResponse'
        "400":
          description: Invalid request body or parameters
          schema:
            $ref: '#/definitions/github_com_blaisecz_sleep-tracker_pkg_problem.Problem'
        "404":
          description: User not found
          schema:
            $ref: '#/definitions/github_com_blaisecz_sleep-tracker_pkg_problem.Problem'
        "409":
          description: Sleep period overlaps with existing log
          schema:
            $ref: '#/definitions/github_com_blaisecz_sleep-tracker_pkg_problem.Problem'
        "500":
          description: Server error
          schema:
            $ref: '#/definitions/github_com_blaisecz_sleep-tracker_pkg_problem.Problem'
      summary: Record sleep
      tags:
      - sleep-logs
  /users/{userId}/sleep-logs/{logId}:
    put:
      consumes:
      - application/json
      description: Update an existing sleep session. All fields are optional - only
        provided fields will be updated.
      parameters:
      - description: User UUID
        example: 550e8400-e29b-41d4-a716-446655440000
        format: uuid
        in: path
        name: userId
        required: true
        type: string
      - description: Sleep Log UUID
        example: 660e8400-e29b-41d4-a716-446655440001
        format: uuid
        in: path
        name: logId
        required: true
        type: string
      - description: Fields to update
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/github_com_blaisecz_sleep-tracker_internal_domain.UpdateSleepLogRequest'
      produces:
      - application/json
      responses:
        "200":
          description: Updated sleep log
          schema:
            $ref: '#/definitions/github_com_blaisecz_sleep-tracker_internal_domain.SleepLogResponse'
        "400":
          description: Invalid request body or parameters
          schema:
            $ref: '#/definitions/github_com_blaisecz_sleep-tracker_pkg_problem.Problem'
        "404":
          description: User or sleep log not found
          schema:
            $ref: '#/definitions/github_com_blaisecz_sleep-tracker_pkg_problem.Problem'
        "409":
          description: Sleep period overlaps with existing log
          schema:
            $ref: '#/definitions/github_com_blaisecz_sleep-tracker_pkg_problem.Problem'
        "500":
          description: Server error
          schema:
            $ref: '#/definitions/github_com_blaisecz_sleep-tracker_pkg_problem.Problem'
      summary: Update sleep log
      tags:
      - sleep-logs
  /users/{userId}/sleep/chronotype:
    get:
      description: Compute the user's chronotype based on their sleep patterns over
        a configurable window.
      parameters:
      - description: User UUID
        example: 550e8400-e29b-41d4-a716-446655440000
        format: uuid
        in: path
        name: userId
        required: true
        type: string
      - default: 30
        description: Number of days to analyze
        in: query
        maximum: 365
        minimum: 1
        name: window_days
        type: integer
      - default: 7
        description: Minimum sleep logs required
        in: query
        maximum: 100
        minimum: 1
        name: min_sleeps
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: Chronotype analysis result
          schema:
            $ref: '#/definitions/github_com_blaisecz_sleep-tracker_internal_domain.ChronotypeResult'
        "400":
          description: Invalid query parameters
          schema:
            $ref: '#/definitions/github_com_blaisecz_sleep-tracker_pkg_problem.Problem'
        "404":
          description: User not found
          schema:
            $ref: '#/definitions/github_com_blaisecz_sleep-tracker_pkg_problem.Problem'
        "500":
          description: Server error
          schema:
            $ref: '#/definitions/github_com_blaisecz_sleep-tracker_pkg_problem.Problem'
      summary: Get user chronotype
      tags:
      - sleep-insights
  /users/{userId}/sleep/insights:
    get:
      description: Generate comprehensive sleep insights using chronotype, metrics,
        and LLM analysis.
      parameters:
      - description: User UUID
        example: 550e8400-e29b-41d4-a716-446655440000
        format: uuid
        in: path
        name: userId
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: Sleep insights with LLM analysis
          schema:
            $ref: '#/definitions/github_com_blaisecz_sleep-tracker_internal_domain.InsightsResponse'
        "404":
          description: User not found
          schema:
            $ref: '#/definitions/github_com_blaisecz_sleep-tracker_pkg_problem.Problem'
        "500":
          description: Server error
          schema:
            $ref: '#/definitions/github_com_blaisecz_sleep-tracker_pkg_problem.Problem'
        "503":
          description: LLM service unavailable
          schema:
            $ref: '#/definitions/github_com_blaisecz_sleep-tracker_pkg_problem.Problem'
      summary: Get LLM-powered sleep insights
      tags:
      - sleep-insights
  /users/{userId}/sleep/insights/feedback:
    post:
      consumes:
      - application/json
      description: Submit a user rating and optional comment for a previous insights
        response.
      parameters:
      - description: User UUID
        example: 550e8400-e29b-41d4-a716-446655440000
        format: uuid
        in: path
        name: userId
        required: true
        type: string
      - description: Feedback request
        in: body
        name: body
        required: true
        schema:
          $ref: '#/definitions/internal_api_handler.FeedbackRequest'
      produces:
      - application/json
      responses:
        "204":
          description: Feedback submitted
        "400":
          description: Invalid request
          schema:
            $ref: '#/definitions/github_com_blaisecz_sleep-tracker_pkg_problem.Problem'
        "500":
          description: Server error
          schema:
            $ref: '#/definitions/github_com_blaisecz_sleep-tracker_pkg_problem.Problem'
      summary: Submit feedback on sleep insights
      tags:
      - sleep-insights
  /users/{userId}/sleep/metrics:
    get:
      description: Compute per-sleep and per-day sleep metrics over a configurable
        window.
      parameters:
      - description: User UUID
        example: 550e8400-e29b-41d4-a716-446655440000
        format: uuid
        in: path
        name: userId
        required: true
        type: string
      - default: 30
        description: Number of days to analyze
        in: query
        maximum: 365
        minimum: 1
        name: window_days
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: Sleep metrics
          schema:
            $ref: '#/definitions/github_com_blaisecz_sleep-tracker_internal_domain.MetricsResponse'
        "400":
          description: Invalid query parameters
          schema:
            $ref: '#/definitions/github_com_blaisecz_sleep-tracker_pkg_problem.Problem'
        "404":
          description: User not found
          schema:
            $ref: '#/definitions/github_com_blaisecz_sleep-tracker_pkg_problem.Problem'
        "500":
          description: Server error
          schema:
            $ref: '#/definitions/github_com_blaisecz_sleep-tracker_pkg_problem.Problem'
      summary: Get sleep metrics
      tags:
      - sleep-insights
swagger: "2.0"
tags:
- description: User management endpoints
  name: users
- description: Sleep session tracking endpoints
  name: sleep-logs
